<div ng-controller="collection_task_dispatch_controller">
    <div>
        <toaster-container toaster-options="{'position-class': 'toast-top-right', 'close-button':true}"></toaster-container>
    </div>
    <form name="form" class="form-validation" novalidate>
        <div class="panel panel-default">
            <div class="panel-body wrapper-sm">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="form-group pull-left"><h1 class="m-n font-thin h4">主管派单</h1></div>
                        <div class="form-group pull-right">
                            <div class="btn-group">
                                <button class="btn btn-sm fms-button-margin-bottom btn-default m-b-xs" ng-click="collectionDispatchAgree()" ng-disabled="submit"><i class=""></i>通过</button>
                                <button class="btn btn-sm fms-button-margin-bottom btn-default m-b-xs" ng-click="collectionDispatchBack()" ng-disabled="submit"><i class=""></i>退回</button>
                                <button class="btn btn-sm fms-button-margin-bottom btn-default m-b-xs" ng-click="collectionRefuse()" ng-disabled="submit"><i class=""></i>拒绝</button>
                                <button class="btn btn-sm fms-button-margin-bottom btn-default m-b-xs" ng-click="close()" ng-disabled="submit"><i class=""></i>返回</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel-body">
                <div class="row">
                    <span style="margin-left: 2%;">申请信息</span>
                </div>
                <div class="form-group row">
                    <label class="col-sm-2 control-label text-right"><b class="form-text-black">承租人</b><b class="form-error">*</b>:</label>
                    <div class="col-sm-6">
                        <div class="row">
                            <div class="col-sm-8" >
                                <input type="text" name="cstmName" placeholder="请输入承租人" class="form-control m-b-xs" ng-model="collectionTaskVo.cstmName"  required disabled>
                                <input type="hidden" name="certifNo" class="form-control m-b-xs" ng-model="collectionTaskVo.certifNo">
                                <p>
                                    <span class="form-info" ng-show=" (form.cstmName.$dirty && form.cstmName.$error.required) || (form.cstmName.$error.required && formValidate)">承租人不能为空</span>
                                </p>
                            </div>
                            <div class="col-sm-2">
                                <button type="button" class="btn btn-default btn-sm" ng-click="overdueDetail()">逾期详情</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-sm-2 control-label text-right"><b class="form-text-black">上门催收级别</b><b class="form-error">*</b>:</label>
                    <div class="col-sm-2">
                        <select name="collectionLevel" ng-model="collectionTaskVo.collectionLevel" class="form-control m-b-xs" ng-options="a.codeValue as a.codeValueName for a in 'collectionLevel' | getList">
                            <option value="">---请选择催收级别---</option>
                        </select>
                        <p>
                            <span class="form-info" ng-show=" (form.collectionLevel.$dirty && form.collectionLevel.$error.required) || (form.collectionLevel.$error.required && formValidate)">上门催收级别不能为空</span>
                        </p>
                    </div>
                    <label class="col-sm-4 control-label text-right"><b class="form-text-black">申请上门时间</b><b class="form-error">*</b>:</label>
                    <div class="col-sm-2">
                        <input type="text" class="form-control m-b-xs" name="applyVisitDate" placeholder="请输入申请上门时间" ng-model="collectionTaskVo.applyVisitDate"  required date-picker>
                        <p>
                            <span class="form-info" ng-show=" (form.applyVisitDate.$dirty && form.applyVisitDate.$error.required) || (form.applyVisitDate.$error.required && formValidate)">申请上门时间不能为空</span>
                        </p>
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-sm-2 control-label text-right"><b class="form-text-black">申请上门地址</b><b class="form-error">*</b>:</label>
                    <div class="col-sm-8">
                        <textarea type="text" name="applyVisitAddr" placeholder="请输入申请上门地址" class="form-control m-b-xs" ng-model="collectionTaskVo.applyVisitAddr"  required ></textarea>
                        <p>
                            <span class="form-info" ng-show=" (form.applyVisitAddr.$dirty && form.applyVisitAddr.$error.required) || (form.applyVisitAddr.$error.required && formValidate)">申请上门地址不能为空</span>
                        </p>
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-sm-2 control-label text-right"><b class="form-text-black">逾期状况描述</b><b class="form-error">*</b>:</label>
                    <div class="col-sm-8">
                        <textarea type="text" name="overdueDescription" placeholder="请输入逾期状况描述" class="form-control m-b-xs" ng-model="collectionTaskVo.overdueDescription"  required ></textarea>
                        <p>
                            <span class="form-info" ng-show=" (form.overdueDescription.$dirty && form.overdueDescription.$error.required) || (form.overdueDescription.$error.required && formValidate)">逾期状况描述不能为空</span>
                        </p>
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-sm-2 control-label text-right"><b class="form-text-black">上门催收原因</b><b class="form-error">*</b>:</label>
                    <div class="col-sm-8">
                        <textarea type="text" name="collectionReason" placeholder="请输入上门催收原因" class="form-control m-b-xs" ng-model="collectionTaskVo.collectionReason"  required ></textarea>
                        <p>
                            <span class="form-info" ng-show=" (form.collectionReason.$dirty && form.collectionReason.$error.required) || (form.collectionReason.$error.required && formValidate)">上门催收原因不能为空</span>
                        </p>
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-sm-2 control-label text-right"><b class="form-text-black">车辆使用情况</b><b class="form-error">*</b>:</label>
                    <div class="col-sm-8">
                        <textarea type="text" name="vehicleSituation" placeholder="请输入车辆使用情况" class="form-control m-b-xs" ng-model="collectionTaskVo.vehicleSituation"  required ></textarea>
                        <p>
                            <span class="form-info" ng-show=" (form.vehicleSituation.$dirty && form.vehicleSituation.$error.required) || (form.vehicleSituation.$error.required && formValidate)">车辆使用情况不能为空</span>
                        </p>
                    </div>
                </div>

            </div>

            <div class="panel-body">
                <div class="row">
                    <span style="margin-left: 2%;">客户基本信息</span>
                </div>
                <table border="1" class="table table-striped m-b-none" id="cstm_contact_table">
                </table>
            </div>

            <div class="panel-body">
                <div class="row">
                    <span style="margin-left: 2%;">任务派单</span>
                </div>
                <div class="form-group row">
                    <label class="col-sm-2 control-label text-right"><b class="form-text-black">派单类型</b><b class="form-error">*</b>:</label>
                    <div class="col-sm-2">
                        <select name="dispatchType" ng-model="collectionTaskVo.dispatchType" class="form-control m-b-xs" ng-options="a.codeValue as a.codeValueName for a in 'dispatchType' | getList" ng-change="changeDispatch()" required>
                            <option value="">---请选择派单类型---</option>
                        </select>
                        <p>
                            <span class="form-info" ng-show=" (form.dispatchType.$dirty && form.dispatchType.$error.required) || (form.dispatchType.$error.required && formValidate)">上门催收级别不能为空</span>
                        </p>
                    </div>
                    <div ng-if="collectionTaskVo.dispatchType == 1">
                        <label class="col-sm-2 control-label text-right"><b class="form-text-black">指派人员</b><b class="form-error">*</b>:</label>
                        <div class="col-sm-2">
                            <input type="text" name="dispatchUserName" placeholder="请输入指派人员" class="form-control m-b-xs" ng-model="collectionTaskVo.dispatchUserName" ng-focus="getDispatchUserName()" required >
                            <input type="hidden" name="dispatchUser" class="form-control m-b-xs" ng-model="collectionTaskVo.dispatchUser">
                            <p>
                                <span class="form-info" ng-show=" (form.dispatchUser.$dirty && form.dispatchUser.$error.required) || (form.dispatchUser.$error.required && formValidate)">指派人员不能为空</span>
                            </p>
                        </div>
                    </div>
                    <div ng-if="collectionTaskVo.dispatchType == 2">
                        <label class="col-sm-2 control-label text-right"><b class="form-text-black">登记人员</b><b class="form-error">*</b>:</label>
                        <div class="col-sm-2">
                            <input type="text" name="registerUserName" placeholder="请输入登记人员" class="form-control m-b-xs" ng-model="collectionTaskVo.registerUserName" ng-focus="getRegisterUserName()" required >
                            <input type="hidden" name="registerUser" class="form-control m-b-xs" ng-model="collectionTaskVo.registerUser">
                            <p>
                                <span class="form-info" ng-show=" (form.registerUser.$dirty && form.registerUser.$error.required) || (form.registerUser.$error.required && formValidate)">登记人员不能为空</span>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="form-group row" ng-if="collectionTaskVo.dispatchType == 2">
                    <label class="col-sm-2 control-label text-right"><b class="form-text-black">第三方机构名称</b><b class="form-error">*</b>:</label>
                    <div class="col-sm-2">
                        <input type="text" name="tollyName" placeholder="请输入第三方机构名称" class="form-control m-b-xs" ng-model="collectionTaskVo.tollyName"  required >
                        <p>
                            <span class="form-info" ng-show=" (form.tollyName.$dirty && form.tollyName.$error.required) || (form.tollyName.$error.required && formValidate)">第三方机构名称不能为空</span>
                        </p>
                    </div>

                    <label class="col-sm-2 control-label text-right"><b class="form-text-black">第三方机构联系人</b><b class="form-error">*</b>:</label>
                    <div class="col-sm-2">
                        <input type="text" name="tollyContactName" placeholder="请输入第三方机构联系人" class="form-control m-b-xs" ng-model="collectionTaskVo.tollyContactName"  required >
                        <p>
                            <span class="form-info" ng-show=" (form.tollyContactName.$dirty && form.tollyContactName.$error.required) || (form.tollyContactName.$error.required && formValidate)">第三方机构联系人不能为空</span>
                        </p>
                    </div>

                    <label class="col-sm-2 control-label text-right"><b class="form-text-black">第三方机构联系电话</b><b class="form-error">*</b>:</label>
                    <div class="col-sm-2">
                        <input type="text" name="tollyMobileNo" placeholder="请输入第三方机构联系电话" class="form-control m-b-xs" ng-model="collectionTaskVo.tollyMobileNo" ng-pattern="/^1[345789]\d{9}$/" required >
                        <p>
                            <span class="form-info" ng-show=" (form.tollyMobileNo.$dirty && form.tollyMobileNo.$error.required) || (form.tollyMobileNo.$error.required && formValidate)">第三方机构联系电话不能为空</span>
                            <span class="form-info" ng-show=" (form.tollyMobileNo.$error.pattern && !form.tollyMobileNo.$error.required) || (form.tollyMobileNo.$error.pattern && formValidate && !form.tollyMobileNo.$error.required)">请输入正确的手机号码</span>
                        </p>
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-sm-2 control-label text-right"><b class="form-text-black">家访要求</b><b class="form-error">*</b>:</label>
                    <div class="col-sm-8">
                        <textarea type="text" limit-word name="collectionRequirement" placeholder="请输入家访要求" class="form-control m-b-xs" ng-model="collectionTaskVo.collectionRequirement"  required ></textarea>
                        <p>
                            <span class="form-info" ng-show=" (form.collectionRequirement.$dirty && form.collectionRequirement.$error.required) || (form.collectionRequirement.$error.required && formValidate)">家访要求不能为空</span>
                        </p>
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-sm-2 control-label text-right"><b class="form-text-black">备注</b>:</label>
                    <div class="col-sm-8">
                        <textarea type="text" limit-word="1000" name="remark" placeholder="请输入备注" class="form-control m-b-xs" ng-model="collectionTaskVo.remark"></textarea>
                        <!--<p>
                            <span class="form-info" ng-show=" (form.remark.$dirty && form.remark.$error.required) || (form.remark.$error.required && formValidate)">备注不能为空</span>
                        </p>-->
                    </div>
                </div>
            </div>
            <!--流程日志-->
            <div class="panel-body wrapper-sm">
                <div ng-include="'tpl/common/process_log/process_log_list.html'"></div>
            </div>
        </div>
    </form>
</div>
